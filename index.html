import React, { useState, useEffect, useMemo } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { User, Phone, Building2, ChevronRight, Printer, Info, CheckCircle2, Heart, Calendar, RefreshCcw, FileText, ShieldCheck, Wallet, Activity, Coins, PhoneCall, Download, AlertTriangle, ThumbsUp, Zap } from 'lucide-react';

// *** 구글 시트 연동 설정 ***
const GOOGLE_SHEET_CSV_URL = ""; 

// --- 기본 하드코딩 데이터 (260120.csv 파일 기준) ---
const DEFAULT_RATES = {
  main: {
    m: { 40: 660, 41: 680, 42: 700, 43: 720, 44: 750, 45: 780, 50: 930, 55: 1110, 60: 1340, 66: 1750, 67: 1830, 68: 1920, 69: 2020 },
    f: { 40: 530, 41: 540, 45: 610, 50: 720, 51: 750, 52: 770, 53: 800, 54: 830, 55: 860, 56: 900, 60: 990, 66: 1260, 67: 1320, 68: 1380, 69: 1450 }
  },
  premiumExemption: {
    m: { 40: 150, 45: 266, 50: 450, 55: 750, 60: 1200, 65: 1800, 69: 2500 },
    f: { 40: 150, 45: 260, 50: 450, 55: 720, 60: 1100, 65: 1700, 69: 2400 }
  },
  targetDementia: {
    m: { 40: 21, 41: 24, 42: 28, 43: 31, 44: 35, 45: 39, 50: 65, 55: 105, 60: 155, 65: 220, 69: 290 },
    f: { 40: 26, 45: 38, 50: 48, 51: 51, 52: 54, 53: 56, 54: 59, 55: 60, 56: 62, 60: 85, 65: 110, 69: 140 }
  },
  diagnosis: {
    m: { 40: 800, 41: 830, 42: 860, 43: 890, 44: 920, 45: 950, 50: 1200, 55: 1550, 60: 2000, 66: 2800, 69: 3300 },
    f: { 40: 950, 45: 1100, 50: 1400, 55: 1800, 60: 2300, 66: 3100, 69: 3700 }
  },
  complexCare: {
    m: { 40: 985, 41: 1019, 42: 1055, 43: 1093, 44: 1132, 45: 1172, 50: 1450, 55: 1850, 60: 2350, 65: 3100, 69: 3950 },
    f: { 40: 1280, 45: 1650, 50: 2144, 51: 2226, 52: 2536, 53: 2407, 54: 2506, 55: 2613, 56: 2727, 60: 3200, 65: 4100, 69: 5200 }
  },
  welfareEquip: {
    m: { 40: 1789, 41: 1854, 42: 1923, 43: 1995, 44: 2071, 45: 2150, 50: 2700, 55: 3400, 60: 4300, 65: 5500, 69: 6800 },
    f: { 40: 2500, 45: 3350, 50: 4490, 51: 4667, 52: 5389, 53: 5055, 54: 5269, 55: 5498, 56: 5744, 60: 6700, 65: 8500, 69: 10500 }
  },
  mildCare: {
    m: { 40: 2682, 41: 2779, 42: 2881, 43: 2988, 44: 3100, 45: 3220, 50: 4050, 55: 5100, 60: 6450, 65: 8250, 69: 10200 },
    f: { 40: 3800, 45: 4950, 50: 6421, 51: 6673, 52: 7723, 53: 7225, 54: 7529, 55: 7855, 56: 8206, 60: 9600, 65: 12200, 69: 15000 }
  },
  homeVisit: {
    m: { 40: 4510, 41: 4650, 42: 4800, 43: 4950, 44: 5100, 45: 5250, 50: 6200, 55: 7400, 60: 9000, 65: 11000, 69: 13500 },
    f: { 40: 3850, 45: 4650, 50: 5600, 51: 5820, 52: 6723, 53: 6301, 54: 6565, 55: 6849, 56: 7154, 60: 8400, 65: 10200, 69: 12800 }
  }
};

// --- 그룹별 담보 인수 한도 ---
const getLimits = (age) => {
  if (age <= 59) return { complex: 80, welfare: 20, visit: 20, mild: 70, diagnosis: 1000, group: 1 };
  else if (age <= 65) return { complex: 80, welfare: 20, visit: 20, mild: 70, diagnosis: 400, group: 2 };
  else return { complex: 20, welfare: 10, visit: 10, mild: 40, diagnosis: 400, group: 3 };
};

const getRate = (rates, type, gender, age) => {
  const genderKey = gender === '남성' ? 'm' : 'f';
  const table = rates?.[type]?.[genderKey] || DEFAULT_RATES[type][genderKey];
  if (table[age]) return table[age];
  const ages = Object.keys(table).map(Number).sort((a, b) => a - b);
  if (age <= ages[0]) return table[ages[0]];
  if (age >= ages[ages.length - 1]) return table[ages[ages.length - 1]];
  for (let i = 0; i < ages.length - 1; i++) {
    if (age >= ages[i] && age <= ages[i+1]) {
      const x0 = ages[i], x1 = ages[i+1];
      const y0 = table[x0], y1 = table[x1];
      if (x0 === x1) return y0;
      return Math.round(y0 + (y1 - y0) * (age - x0) / (x1 - x0));
    }
  }
  return table[ages[0]];
};

const loadScript = (src) => {
  return new Promise((resolve, reject) => {
    if (document.querySelector(`script[src="${src}"]`)) {
      resolve();
      return;
    }
    const script = document.createElement('script');
    script.src = src;
    script.onload = resolve;
    script.onerror = reject;
    document.body.appendChild(script);
  });
};

const App = () => {
  const [step, setStep] = useState(0); 
  const [customer, setCustomer] = useState({ name: '', birth: '', gender: '여성', contact: '' });
  const [agent, setAgent] = useState({ name: '', contact: '', branch: '메타리치', branch_name: '' });
  const [ratesData, setRatesData] = useState(DEFAULT_RATES);
  const [isRatesLoading, setIsRatesLoading] = useState(false);
  const [dataSource, setDataSource] = useState('기본값'); 
  const [isPdfGenerating, setIsPdfGenerating] = useState(false);

  useEffect(() => {
    loadScript("https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js");
    loadScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js");

    if (!GOOGLE_SHEET_CSV_URL) return;
    const fetchRates = async () => {
      setIsRatesLoading(true);
      try {
        const response = await fetch(GOOGLE_SHEET_CSV_URL);
        const text = await response.text();
        const rows = text.split('\n').map(row => row.split(','));
        const newRates = JSON.parse(JSON.stringify(DEFAULT_RATES));
        Object.keys(newRates).forEach(key => { newRates[key].m = {}; newRates[key].f = {}; });
        rows.forEach((row, index) => {
          if (index < 1 || row.length < 10) return;
          const category = row[1];
          if (!category) return;
          const ageMatch = category.match(/(\d+)세/);
          const genderMatch = category.match(/(남자|여자)/);
          if (ageMatch && genderMatch) {
            const age = parseInt(ageMatch[1]);
            const gender = genderMatch[1] === '남자' ? 'm' : 'f';
            const parseVal = (val) => val ? parseInt(val.replace(/[^0-9]/g, '')) || 0 : 0;
            newRates.main[gender][age] = parseVal(row[2]);
            newRates.premiumExemption[gender][age] = parseVal(row[3]);
            newRates.targetDementia[gender][age] = parseVal(row[4]);
            newRates.diagnosis[gender][age] = parseVal(row[5]);
            newRates.mildCare[gender][age] = parseVal(row[6]);
            newRates.welfareEquip[gender][age] = parseVal(row[7]);
            newRates.homeVisit[gender][age] = parseVal(row[8]);
            newRates.complexCare[gender][age] = parseVal(row[9]);
          }
        });
        setRatesData(newRates);
        setDataSource('구글시트');
      } catch (error) { setDataSource('기본값'); } finally { setIsRatesLoading(false); }
    };
    fetchRates();
  }, []);

  const handlePhoneChange = (e, setter, field) => {
    const value = e.target.value.replace(/[^0-9]/g, '');
    let formatted = value;
    if (value.length > 3 && value.length <= 7) {
      formatted = `${value.slice(0, 3)}-${value.slice(3)}`;
    } else if (value.length > 7) {
      formatted = `${value.slice(0, 3)}-${value.slice(3, 7)}-${value.slice(7, 11)}`;
    }
    setter(prev => ({ ...prev, [field]: formatted }));
  };

  const insAge = useMemo(() => {
    if (!customer.birth) return 55;
    const today = new Date();
    const birthDate = new Date(customer.birth);
    let age = today.getFullYear() - birthDate.getFullYear();
    const m = today.getMonth() - birthDate.getMonth();
    if (m > 6 || (m === 6 && today.getDate() >= birthDate.getDate())) age++;
    else if (m < -6 || (m === -6 && today.getDate() < birthDate.getDate())) age--;
    return age;
  }, [customer.birth]);

  const planData = useMemo(() => {
    const gender = customer.gender;
    const age = insAge;
    const limits = getLimits(age);
    const rMain = getRate(ratesData, 'main', gender, age);
    const rExemption = getRate(ratesData, 'premiumExemption', gender, age);
    const rTarget = getRate(ratesData, 'targetDementia', gender, age);
    const rDiag = getRate(ratesData, 'diagnosis', gender, age);
    const rComplex = getRate(ratesData, 'complexCare', gender, age);
    const rWelfare = getRate(ratesData, 'welfareEquip', gender, age);
    const rMild = getRate(ratesData, 'mildCare', gender, age);
    const rVisit = getRate(ratesData, 'homeVisit', gender, age);

    const calcPrem = (p) => (
      (p.main / 100 * rMain) +
      (p.main / 100 * rExemption) +
      (p.target / 100 * rTarget) + 
      (p.diagnosis / 100 * rDiag) +
      (p.complex / 10 * rComplex) + 
      (p.welfare / 10 * rWelfare) + 
      (p.mild / 10 * rMild) + 
      (p.visit / 10 * rVisit)
    );

    // --- 3그룹 (66~69세) ---
    if (limits.group === 3) {
      const plan3 = { 
        main: 100, target: 100, diagnosis: limits.diagnosis, 
        complex: limits.complex, welfare: limits.welfare, 
        visit: limits.visit, mild: limits.mild 
      };
      plan3.total = calcPrem(plan3);
      return { p1: plan3, group: 3 };
    }

    // --- 1, 2그룹 (40~65세) ---
    // [1안] 가성비
    let p1 = { 
      main: 100, target: 100, diagnosis: 0, 
      complex: 80, welfare: 20, 
      mild: 0, visit: 0 
    };
    let prem1 = calcPrem(p1);
    while (prem1 < 30000 && p1.mild < limits.mild) { 
      p1.mild += 10; 
      prem1 = calcPrem(p1); 
    }
    p1.total = prem1;

    // [2안] 로직 개선: 150만원(경증50) 우선 확보 후 가격대별 조정
    // 목표: 150만원 확보하면서 10만원 미만 유지. 
    // 7만원 미만이면 더 추가하여 7-8만원대로 맞춤. 9만원 넘으면 10만원 미만에서 마무리.
    
    // Step 1: 기본 150만원 설계 (복합80+복지20 + 경증50)
    let p2Basic = { 
      main: 100, target: 100, diagnosis: 0,
      complex: 80, welfare: 20, 
      mild: Math.min(50, limits.mild), visit: 0
    };
    let prem2Basic = calcPrem(p2Basic);
    let p2Final = p2Basic;
    let isSpecial = false;

    if (prem2Basic >= 90000) {
      // Case A: 150만원 설계가 9만원 이상임 -> 10만원 미만에서 마무리
      if (prem2Basic > 100000) {
        // 10만원 초과시 경증 줄여서 10만원 맞추기
        while (calcPrem(p2Final) > 100000 && p2Final.mild > 10) {
          p2Final.mild -= 10;
        }
      }
      // 9만원대면 그대로 유지 (p2Basic)
    } else if (prem2Basic < 70000) {
      // Case B: 7만원 미만 -> 업그레이드 시도 (경증Max -> 방문Max -> 진단금)
      isSpecial = true;
      let p2Upgrade = { ...p2Basic };
      
      // 1. 경증 최대한도 (70)
      p2Upgrade.mild = limits.mild;
      
      // 2. 방문요양 최대한도 (20)
      p2Upgrade.visit = limits.visit;
      
      let premUpgrade = calcPrem(p2Upgrade);

      // 3. 그래도 7만원 미만이면 진단금 추가
      if (premUpgrade < 70000 && limits.diagnosis > 0) {
        p2Upgrade.diagnosis = 1000; // 1000만원 추가
      }

      // 최종 검증: 10만원 넘으면 역순으로 줄이기
      while (calcPrem(p2Upgrade) > 100000) {
        if (p2Upgrade.diagnosis > 0) {
          p2Upgrade.diagnosis = 0;
        } else if (p2Upgrade.visit > 0) {
          p2Upgrade.visit = 0;
        } else if (p2Upgrade.mild > 50) { // 기본 50까지는 내림
          p2Upgrade.mild -= 10;
        } else {
          break; // 기본 150만원 선은 지킴 (단, 이것도 10만원 넘으면 위 Case A 로직 따름이나 여기선 upgrade 로직이라 ok)
        }
      }
      p2Final = p2Upgrade;
    } else {
      // Case C: 7~9만원 사이 -> 현상 유지
      p2Final = p2Basic;
    }
    
    p2Final.total = calcPrem(p2Final);
    return { p1, p2: p2Final, isSpecial, group: limits.group };
  }, [customer.gender, insAge, ratesData]);

  const generatePDF = async () => {
    setIsPdfGenerating(true);
    try {
      if (!window.jspdf || !window.html2canvas) {
        alert("PDF 생성 라이브러리가 로드되지 않았습니다. 잠시 후 다시 시도해주세요.");
        return;
      }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      const pageIds = ['proposal-page-1', 'proposal-page-2', 'proposal-page-3', 'proposal-page-4', 'proposal-page-5', 'proposal-page-6', 'proposal-page-7'];
      const validPageIds = planData.group === 3 ? pageIds.filter(id => id !== 'proposal-page-4') : pageIds;

      for (let i = 0; i < validPageIds.length; i++) {
        const pageId = validPageIds[i];
        const element = document.getElementById(pageId);
        if (!element) continue;
        const canvas = await window.html2canvas(element, { scale: 2, useCORS: true, logging: false, windowWidth: element.scrollWidth, windowHeight: element.scrollHeight });
        const imgData = canvas.toDataURL('image/jpeg', 1.0);
        const imgWidth = 210; 
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        if (i > 0) doc.addPage();
        doc.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
      }
      doc.save(`${customer.name}_재가요양보험_제안서.pdf`);
    } catch (error) { alert("PDF 생성 중 오류가 발생했습니다."); } finally { setIsPdfGenerating(false); }
  };

  const MetarichLogo = ({ className }) => (
    <div className={`flex items-center ${className}`}>
      <img src="https://i.ibb.co/Q7VPpx5J/7465d2c7c18c6.png" alt="Metarich Logo" className="h-10 w-auto object-contain" />
    </div>
  );

  return (
    <div className="min-h-screen bg-slate-50 p-0 md:p-8 font-sans print:bg-white print:p-0">
      
      {/* Intro */}
      {step === 0 && (
        <div className="max-w-md mx-auto mt-20 p-4 space-y-6">
          <Card className="border-none shadow-2xl rounded-3xl overflow-hidden bg-white/90 backdrop-blur-sm">
            <CardContent className="p-10 flex flex-col items-center text-center space-y-8">
              <MetarichLogo className="h-16 mb-4" />
              <div>
                <h1 className="text-2xl font-black text-slate-800 mb-2">재가요양보험<br/>원스톱 제안 시스템</h1>
                <p className="text-slate-500">전문가 수준의 설계를 단 1분 만에</p>
              </div>
              <Button size="lg" className="w-full bg-red-600 h-16 rounded-2xl text-xl font-bold shadow-lg hover:bg-red-700 transition-all hover:scale-[1.02]" onClick={() => setStep(1)}>
                제안서 만들기 <ChevronRight className="ml-2" />
              </Button>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Input */}
      {step === 1 && (
        <div className="max-w-xl mx-auto mt-10 p-4">
          <Card className="border-none shadow-2xl rounded-3xl">
            <CardHeader className="bg-gradient-to-r from-red-600 to-red-700 text-white rounded-t-3xl p-8">
               <CardTitle className="text-2xl flex items-center gap-2 font-bold">
                 <FileText size={24} /> 고객 정보 입력
               </CardTitle>
               <p className="text-red-100 opacity-90">설계에 필요한 최소한의 정보를 입력해주세요.</p>
            </CardHeader>
            <CardContent className="p-8 space-y-8 bg-white rounded-b-3xl">
              <div className="space-y-6">
                <div className="flex items-center gap-2 text-slate-800 font-bold border-b pb-2">
                  <User size={20} className="text-red-600"/> <span>피보험자 정보</span>
                </div>
                <div className="grid grid-cols-2 gap-6">
                  <div className="space-y-2">
                    <Label className="text-slate-500">성함</Label>
                    <Input className="h-12 text-lg bg-slate-50 border-slate-200" placeholder="예: 홍길동" value={customer.name} onChange={e => setCustomer({...customer, name: e.target.value})} />
                  </div>
                  <div className="space-y-2">
                    <Label className="text-slate-500">성별</Label>
                    <div className="flex gap-2 h-12">
                      {['남성', '여성'].map(g => (
                        <Button key={g} type="button" variant={customer.gender === g ? "default" : "outline"} className={`flex-1 text-lg ${customer.gender === g ? 'bg-red-600 hover:bg-red-700' : 'border-slate-200'}`} onClick={() => setCustomer({...customer, gender: g})}>{g}</Button>
                      ))}
                    </div>
                  </div>
                  <div className="col-span-2 grid grid-cols-2 gap-6">
                    <div className="space-y-2">
                      <Label className="text-slate-500">생년월일</Label>
                      <Input 
                        className="h-12 text-lg bg-slate-50 border-slate-200" 
                        type="date" 
                        max="9999-12-31" 
                        value={customer.birth} 
                        onChange={e => setCustomer({...customer, birth: e.target.value})} 
                      />
                    </div>
                    <div className="space-y-2">
                      <Label className="text-slate-500">연락처</Label>
                      <Input 
                        className="h-12 text-lg bg-slate-50 border-slate-200" 
                        placeholder="010-0000-0000" 
                        value={customer.contact} 
                        onChange={e => handlePhoneChange(e, setCustomer, 'contact')} 
                        maxLength={13}
                      />
                    </div>
                  </div>
                  {customer.birth && <p className="col-span-2 text-right text-sm font-medium text-red-600">보험나이 {insAge}세 (그룹 {getLimits(insAge).group})</p>}
                </div>
              </div>

              <div className="space-y-6">
                <div className="flex items-center gap-2 text-slate-800 font-bold border-b pb-2">
                  <User size={20} className="text-blue-600"/> <span>설계사 정보</span>
                </div>
                <div className="grid grid-cols-2 gap-6">
                  <div className="space-y-2">
                    <Label className="text-slate-500">성함</Label>
                    <Input className="h-12 text-lg bg-slate-50 border-slate-200" placeholder="김철수 팀장" value={agent.name} onChange={e => setAgent({...agent, name: e.target.value})} />
                  </div>
                  <div className="space-y-2">
                    <Label className="text-slate-500">연락처</Label>
                    <Input 
                      className="h-12 text-lg bg-slate-50 border-slate-200" 
                      placeholder="010-0000-0000" 
                      value={agent.contact} 
                      onChange={e => handlePhoneChange(e, setAgent, 'contact')} 
                      maxLength={13}
                    />
                  </div>
                  <div className="col-span-2 space-y-2">
                    <Label className="text-slate-500">소속 지점</Label>
                    <div className="flex items-center gap-2">
                      <div className="bg-slate-100 h-12 flex items-center px-4 rounded-md text-slate-600 border border-slate-200 font-medium whitespace-nowrap">메타리치</div>
                      <Input 
                        className="h-12 text-lg bg-slate-50 border-slate-200" 
                        placeholder="강남본부" 
                        value={agent.branch_name} 
                        onChange={e => setAgent({...agent, branch_name: e.target.value, branch: `메타리치 ${e.target.value}`})} 
                      />
                    </div>
                  </div>
                </div>
              </div>

              <Button size="lg" className="w-full h-16 text-xl bg-slate-900 hover:bg-slate-800 rounded-xl shadow-lg mt-4" disabled={!customer.name || !customer.birth || !agent.name || !agent.contact || !agent.branch_name} onClick={() => setStep(2)}>
                설계 결과 확인하기 <ChevronRight className="ml-2" />
              </Button>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Loading */}
      {step === 2 && (
        <div className="flex flex-col items-center justify-center min-h-[80vh]">
          <div className="relative">
            <div className="animate-spin h-24 w-24 border-8 border-slate-100 border-t-red-600 rounded-full"></div>
            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
              <Heart className="text-red-600 fill-red-600 animate-pulse" size={32} />
            </div>
          </div>
          <h2 className="text-2xl font-bold text-slate-800 mt-8">고객님을 위한 최적의 플랜을 설계 중입니다</h2>
          <p className="text-slate-500 mt-2 text-lg">{insAge}세 {customer.gender} / 맞춤형 담보 한도 적용</p>
          {setTimeout(() => setStep(3), 1500) && null}
        </div>
      )}

      {/* Result */}
      {step === 3 && (
        <div className="max-w-[210mm] mx-auto print:max-w-none">
          <div className="flex justify-between items-center p-4 print:hidden bg-white shadow-lg mb-8 rounded-xl sticky top-4 z-50 border border-slate-100">
             <Button variant="ghost" onClick={() => setStep(1)} className="text-slate-600 hover:bg-slate-100"><RefreshCcw className="mr-2 w-4 h-4"/> 정보 수정</Button>
             <div className="flex gap-2">
                <Button variant="outline" className="hidden md:flex border-slate-300" onClick={() => window.print()}><Printer className="mr-2 w-4 h-4"/> 인쇄 (기본)</Button>
                <Button className="bg-slate-900 hover:bg-slate-800 shadow-md" onClick={generatePDF} disabled={isPdfGenerating}>
                  {isPdfGenerating ? (
                    <><RefreshCcw className="mr-2 w-4 h-4 animate-spin"/> 생성 중...</>
                  ) : (
                    <><Download className="mr-2 w-4 h-4"/> PDF 다운로드</>
                  )}
                </Button>
             </div>
          </div>

          {/* PAGE 1: 표지 */}
          <div id="proposal-page-1" className="bg-white w-full aspect-[1/1.414] p-[20mm] flex flex-col justify-between shadow-2xl mb-8 print:shadow-none print:m-0 break-after-page relative overflow-hidden">
            <div className="absolute top-0 right-0 w-[400px] h-[400px] bg-red-50 rounded-full translate-x-1/3 -translate-y-1/3 -z-0"></div>
            <div className="z-10 flex justify-between items-start">
              <div className="text-sm font-bold text-red-600 tracking-widest border-b-2 border-red-600 pb-1">PREMIUM PLAN</div>
              <MetarichLogo className="h-10" />
            </div>
            <div className="z-10 mt-10">
              <h1 className="text-[52px] font-black text-slate-900 leading-tight mb-6">
                <span className="text-red-600">{customer.name}</span>님을 위한<br/>
                평생 든든한<br/>
                재가요양보장 플랜
              </h1>
              <p className="text-xl text-slate-500 font-medium">
                내가 살던 집에서 편안하게,<br/>
                경제적 부담 없이 최고의 케어를 받는 방법
              </p>
            </div>
            <div className="z-10 mt-auto pt-10 flex justify-between items-end border-t border-slate-200">
              <div className="text-left">
                <div className="text-slate-400 text-xs font-bold uppercase mb-1">Presented by</div>
                <div className="text-lg font-bold text-slate-800">{agent.branch}</div>
                <div className="text-base text-slate-600">{agent.name} 전문가</div>
                <div className="text-sm text-slate-500">{agent.contact}</div>
              </div>
              <div className="text-right">
                <div className="text-slate-400 text-xs font-bold uppercase mb-1">Date</div>
                <div className="text-lg font-bold text-slate-800">{new Date().toLocaleDateString()}</div>
              </div>
            </div>
          </div>

          {/* PAGE 2: 설명 페이지 */}
          <div id="proposal-page-2" className="bg-white w-full aspect-[1/1.414] p-[20mm] shadow-2xl mb-8 print:shadow-none print:m-0 break-after-page">
            <h2 className="text-3xl font-bold mb-8 flex items-center gap-3">
              <div className="w-2 h-8 bg-red-600"></div>
              추천 보험 상품 안내
            </h2>
            <div className="bg-slate-50 rounded-2xl p-6 border border-slate-200 mb-8">
              <div className="flex items-center gap-3 mb-2">
                <div className="bg-red-100 p-2 rounded-full"><FileText className="text-red-600" size={20}/></div>
                <h3 className="text-lg font-bold text-slate-800">상품명</h3>
              </div>
              <p className="text-2xl font-black text-slate-900 ml-12">
                (무)흥국생명 치매담은시니어보장보험<span className="text-lg font-medium text-slate-500 ml-2">(해약환급금미지급형V2)</span>
              </p>
            </div>
            
            <div className="grid grid-cols-2 gap-6 mb-8">
              <div className="bg-blue-50 p-6 rounded-3xl border border-blue-100">
                <div className="flex items-center gap-2 mb-4">
                  <Activity className="text-blue-600" size={24}/>
                  <h3 className="text-lg font-bold text-blue-900">노인장기요양보험 (국가)</h3>
                </div>
                <ul className="space-y-2 text-sm text-slate-600">
                  <li className="flex gap-2"><CheckCircle2 size={16} className="text-blue-400 mt-0.5"/> <span>국민건강보험공단 운영 사회보험</span></li>
                  <li className="flex gap-2"><CheckCircle2 size={16} className="text-blue-400 mt-0.5"/> <span>요양 비용의 85~100% 지원</span></li>
                  <li className="flex gap-2"><CheckCircle2 size={16} className="text-blue-400 mt-0.5"/> <span>시설/재가 급여 현물 지원 중심</span></li>
                </ul>
              </div>
              <div className="bg-red-50 p-6 rounded-3xl border border-red-100">
                <div className="flex items-center gap-2 mb-4">
                  <ShieldCheck className="text-red-600" size={24}/>
                  <h3 className="text-lg font-bold text-red-900">치매담은시니어보험 (민영)</h3>
                </div>
                <ul className="space-y-2 text-sm text-slate-600">
                  <li className="flex gap-2"><CheckCircle2 size={16} className="text-red-400 mt-0.5"/> <span>국가 지원 외 <strong>추가 현금 보장</strong></span></li>
                  <li className="flex gap-2"><CheckCircle2 size={16} className="text-red-400 mt-0.5"/> <span><strong>납입면제:</strong> 장기요양 판정 시 보험료 면제</span></li>
                  <li className="flex gap-2"><CheckCircle2 size={16} className="text-red-400 mt-0.5"/> <span>매월 정해진 금액을 <strong>연금처럼 수령</strong></span></li>
                </ul>
              </div>
            </div>
            
            {/* 2행 배열 (상하 배치) */}
            <div className="space-y-6 mb-8">
              <div className="bg-gradient-to-r from-slate-800 to-slate-900 rounded-3xl p-8 text-white shadow-xl">
                <div className="flex items-start gap-4">
                  <div className="bg-white/20 p-3 rounded-full">
                    <Wallet size={28} className="text-white" />
                  </div>
                  <div>
                    <h3 className="text-xl font-bold mb-2">등급만 받으면 "매월 현금" 지급!</h3>
                    <p className="text-slate-200 leading-relaxed text-sm opacity-90">
                      장기요양등급(1~5등급) 판정 후 재가급여 이용 시,<br/>
                      <span className="font-bold text-white underline">매월 연금처럼 통장으로 보험금이 입금</span>됩니다.<br/>
                      (생활비, 요양비로 자유롭게 활용 가능)
                    </p>
                  </div>
                </div>
              </div>

              <div className="bg-gradient-to-r from-red-600 to-red-700 rounded-3xl p-8 text-white shadow-xl">
                <div className="flex items-start gap-4">
                  <div className="bg-white/20 p-3 rounded-full">
                    <Zap size={28} className="text-white" />
                  </div>
                  <div>
                    <h3 className="text-xl font-bold mb-2">보험료 납입 면제 혜택</h3>
                    <p className="text-red-100 leading-relaxed text-sm opacity-90">
                      장기요양등급(1~5등급) 판정 시,<br/>
                      <span className="font-bold text-white underline">차회 이후의 보험료 납입이 전액 면제</span>됩니다.<br/>
                      경제적 부담 없이 평생 보장을 유지하세요!
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* PAGE 3: 견적서 1안 */}
          <div id="proposal-page-3" className="bg-white w-full aspect-[1/1.414] p-[15mm] shadow-2xl mb-8 print:shadow-none print:m-0 break-after-page">
            <div className="flex justify-between items-end mb-8 pb-4 border-b-2 border-slate-900">
              <div>
                <h2 className="text-3xl font-black text-slate-900">맞춤 설계 [1안]</h2>
                <p className="text-slate-500 mt-1">{planData.group === 3 ? '통합 최적화 플랜 (66~69세 전용)' : '기본 가성비 플랜'}</p>
              </div>
              <div className="text-right">
                <div className="text-2xl font-bold text-red-600">{insAge}세 {customer.gender}</div>
                <div className="text-sm font-medium text-slate-400">95세 만기 / 20년납</div>
              </div>
            </div>

            <div className="bg-slate-50 rounded-xl p-4 mb-8 border border-slate-100">
              <span className="bg-slate-200 text-slate-600 text-xs font-bold px-2 py-1 rounded mr-2">상품명</span>
              <span className="font-bold text-slate-700">(무)흥국생명 치매담은시니어보장보험(해약환급금미지급형V2)</span>
            </div>

            <table className="w-full border-collapse mb-8">
              <thead>
                <tr className="bg-slate-800 text-white text-sm">
                  <th className="p-3 text-left rounded-tl-lg font-medium">보장 항목 (특약명)</th>
                  <th className="p-3 text-center font-medium">가입금액</th>
                  <th className="p-3 text-right rounded-tr-lg font-medium w-32">월 보험료</th>
                </tr>
              </thead>
              <tbody className="text-sm text-slate-700">
                <tr className="border-b border-slate-100 hover:bg-slate-50"><td className="p-3">주계약 (사망/장해)</td><td className="p-3 text-center font-bold">100만원</td><td className="p-3 text-right">{(getRate(ratesData, 'main', customer.gender, insAge)).toLocaleString()}원</td></tr>
                <tr className="border-b border-slate-100 hover:bg-slate-50"><td className="p-3">(무)보험료납입면제특약</td><td className="p-3 text-center font-bold">가입</td><td className="p-3 text-right">{(getRate(ratesData, 'premiumExemption', customer.gender, insAge)).toLocaleString()}원</td></tr>
                <tr className="border-b border-slate-100 hover:bg-slate-50"><td className="p-3">(무)표적치매약물허가치료특약</td><td className="p-3 text-center font-bold">100만원</td><td className="p-3 text-right">{(getRate(ratesData, 'targetDementia', customer.gender, insAge)).toLocaleString()}원</td></tr>
                {planData.p1.diagnosis > 0 && (
                   <tr className="border-b border-slate-100 hover:bg-slate-50"><td className="p-3">(무)경증이상 진단금</td><td className="p-3 text-center font-bold">{planData.p1.diagnosis}만원</td><td className="p-3 text-right">{(getRate(ratesData, 'diagnosis', customer.gender, insAge)/100 * planData.p1.diagnosis).toLocaleString()}원</td></tr>
                )}
                <tr className="border-b border-slate-100 hover:bg-slate-50 bg-blue-50/50"><td className="p-3 font-semibold text-blue-900">(무)장기요양 복합재가급여특약</td><td className="p-3 text-center font-bold text-blue-700">{planData.p1.complex}만원</td><td className="p-3 text-right font-bold text-blue-700">{(getRate(ratesData, 'complexCare', customer.gender, insAge)/10 * planData.p1.complex).toLocaleString()}원</td></tr>
                <tr className="border-b border-slate-100 hover:bg-slate-50"><td className="p-3">(무)복지용구지원특약</td><td className="p-3 text-center font-bold">{planData.p1.welfare}만원</td><td className="p-3 text-right">{(getRate(ratesData, 'welfareEquip', customer.gender, insAge)/10 * planData.p1.welfare).toLocaleString()}원</td></tr>
                {planData.p1.mild > 0 && (
                  <tr className="border-b border-slate-100 hover:bg-slate-50 bg-red-50/50">
                    <td className="p-3 font-semibold text-red-900">(무)경증이상재가급여지원특약</td>
                    <td className="p-3 text-center font-bold text-red-700">{planData.p1.mild}만원</td>
                    <td className="p-3 text-right font-bold text-red-700">{(getRate(ratesData, 'mildCare', customer.gender, insAge)/10 * planData.p1.mild).toLocaleString()}원</td>
                  </tr>
                )}
                {planData.p1.visit > 0 && (
                   <tr className="border-b border-slate-100 hover:bg-slate-50"><td className="p-3">(무)장기요양 방문요양보장특약</td><td className="p-3 text-center font-bold">{planData.p1.visit}만원</td><td className="p-3 text-right">{(getRate(ratesData, 'homeVisit', customer.gender, insAge)/10 * planData.p1.visit).toLocaleString()}원</td></tr>
                )}
              </tbody>
              <tfoot>
                <tr className="bg-slate-100 border-t-2 border-slate-900">
                  <td colSpan="2" className="p-4 text-lg font-bold text-slate-800">월 납입 보험료 합계 ({planData.group === 3 ? '통합안' : '1안'})</td>
                  <td className="p-4 text-right text-lg font-black text-red-600 whitespace-nowrap">{Math.floor(planData.p1.total).toLocaleString()}원</td>
                </tr>
              </tfoot>
            </table>
            
            <div className="mt-10 p-8 bg-blue-50 rounded-2xl">
              <div className="font-bold mb-4 flex items-center gap-2"><Info size={18}/> 보장 혜택 요약</div>
              <div className="space-y-2 text-sm text-slate-700">
                <div className="flex justify-between border-b border-dashed pb-1"><span>(무)장기요양 복합재가급여특약</span> <span className="font-bold">{planData.p1.complex}만원</span></div>
                <div className="flex justify-between border-b border-dashed pb-1"><span>(무)복지용구지원특약</span> <span className="font-bold">{planData.p1.welfare}만원</span></div>
                {planData.p1.mild > 0 && (
                  <div className="flex justify-between border-b border-dashed pb-1"><span>(무)경증이상재가급여지원특약</span> <span className="font-bold text-red-600">{planData.p1.mild}만원</span></div>
                )}
                {planData.p1.visit > 0 && (
                  <div className="flex justify-between border-b border-dashed pb-1"><span>(무)장기요양 방문요양보장특약</span> <span className="font-bold">{planData.p1.visit}만원</span></div>
                )}
              </div>
            </div>

            <div className="mt-6 bg-slate-100 p-6 rounded-2xl text-center border border-slate-200">
              <div className="flex justify-center items-center gap-2 mb-3 text-slate-700 font-bold text-lg">
                <AlertTriangle size={22} className="text-yellow-600"/> 전문가의 솔직한 한마디
              </div>
              <p className="text-lg text-slate-600 leading-relaxed font-medium">
                맞춤설계 [1안]은 최소한의 보험료로 가성비 있는<br/>
                월 보험금을 수령하는 플랜입니다.<br/>
                다만, 보장 금액이 최소한으로 설정되어 있어<br/> 
                물가 상승을 고려할 때 노년에 다소 부족할 수 있습니다.
              </p>
            </div>
          </div>

          {/* PAGE 4: 견적서 2안 (1,2그룹인 경우에만 표시) */}
          {planData.group !== 3 && (
            <div id="proposal-page-4" className="bg-white w-full aspect-[1/1.414] p-[15mm] shadow-2xl mb-8 print:shadow-none print:m-0 break-after-page">
              <div className="flex justify-between items-end mb-8 pb-4 border-b-2 border-red-600">
                <div>
                  <h2 className="text-3xl font-black text-slate-900">맞춤 설계 [2안]</h2>
                  <p className="text-red-600 font-bold mt-1">업그레이드 플랜 (강력 추천)</p>
                </div>
                <div className="text-right">
                  <div className="text-2xl font-bold text-red-600">{insAge}세 {customer.gender}</div>
                  <div className="text-sm font-medium text-slate-400">95세 만기 / 20년납</div>
                </div>
              </div>

              <div className="mb-8 p-4 bg-red-50 rounded-xl font-bold text-red-800">
                보장 강화: 1안 대비 경증재가급여 및 방문요양 보장을 획기적으로 높였습니다.
              </div>

              <table className="w-full border-collapse mb-8">
                <thead>
                  <tr className="bg-red-600 text-white text-sm">
                    <th className="p-3 text-left rounded-tl-lg font-medium">보장 항목 (특약명)</th>
                    <th className="p-3 text-center font-medium">가입금액</th>
                    <th className="p-3 text-right rounded-tr-lg font-medium w-32">월 보험료</th>
                  </tr>
                </thead>
                <tbody className="text-sm text-slate-700">
                  <tr className="border-b border-slate-100 hover:bg-slate-50"><td className="p-3">주계약 (사망/장해)</td><td className="p-3 text-center font-bold">100만원</td><td className="p-3 text-right">{(getRate(ratesData, 'main', customer.gender, insAge)).toLocaleString()}원</td></tr>
                  <tr className="border-b border-slate-100 hover:bg-slate-50"><td className="p-3">(무)보험료납입면제특약</td><td className="p-3 text-center font-bold">가입</td><td className="p-3 text-right">{(getRate(ratesData, 'premiumExemption', customer.gender, insAge)).toLocaleString()}원</td></tr>
                  <tr className="border-b border-slate-100 hover:bg-slate-50"><td className="p-3">(무)표적치매약물허가치료특약</td><td className="p-3 text-center font-bold">100만원</td><td className="p-3 text-right">{(getRate(ratesData, 'targetDementia', customer.gender, insAge)).toLocaleString()}원</td></tr>
                  {planData.p2.diagnosis > 0 && (
                    <tr className="border-b border-slate-100 hover:bg-slate-50 bg-yellow-50">
                      <td className="p-3 font-bold text-yellow-700">(무)경증이상 진단금 (추가)</td>
                      <td className="p-3 text-center font-bold text-yellow-700">{planData.p2.diagnosis}만원</td>
                      <td className="p-3 text-right font-bold text-yellow-700">{(getRate(ratesData, 'diagnosis', customer.gender, insAge)/100 * planData.p2.diagnosis).toLocaleString()}원</td>
                    </tr>
                  )}
                  {/* 2안 공통 항목 */}
                  <tr className="border-b border-slate-100 hover:bg-slate-50 bg-blue-50/50"><td className="p-3 font-semibold text-blue-900">(무)장기요양 복합재가급여특약</td><td className="p-3 text-center font-bold text-blue-700">{planData.p2.complex}만원</td><td className="p-3 text-right font-bold text-blue-700">{(getRate(ratesData, 'complexCare', customer.gender, insAge)/10 * planData.p2.complex).toLocaleString()}원</td></tr>
                  <tr className="border-b border-slate-100 hover:bg-slate-50"><td className="p-3">(무)복지용구지원특약</td><td className="p-3 text-center font-bold">{planData.p2.welfare}만원</td><td className="p-3 text-right">{(getRate(ratesData, 'welfareEquip', customer.gender, insAge)/10 * planData.p2.welfare).toLocaleString()}원</td></tr>
                  
                  {/* 2안 강화 항목 */}
                  <tr className="border-b border-slate-100 hover:bg-slate-50 bg-red-100">
                    <td className="p-3 font-bold text-red-700">(무)경증이상재가급여지원특약 (강화)</td>
                    <td className="p-3 text-center font-bold text-red-700">{planData.p2.mild}만원</td>
                    <td className="p-3 text-right font-bold text-red-700">{(getRate(ratesData, 'mildCare', customer.gender, insAge)/10 * planData.p2.mild).toLocaleString()}원</td>
                  </tr>
                  {planData.p2.visit > 0 && (
                    <tr className="border-b border-slate-100 hover:bg-slate-50 bg-red-100">
                      <td className="p-3 font-bold text-red-700">(무)장기요양 방문요양보장특약</td>
                      <td className="p-3 text-center font-bold text-red-700">{planData.p2.visit}만원</td>
                      <td className="p-3 text-right font-bold text-red-700">{(getRate(ratesData, 'homeVisit', customer.gender, insAge)/10 * planData.p2.visit).toLocaleString()}원</td>
                    </tr>
                  )}
                </tbody>
                <tfoot>
                  <tr className="bg-slate-100 border-t-2 border-slate-900">
                    <td colSpan="2" className="p-4 text-lg font-bold text-slate-800">월 납입 보험료 합계 (2안)</td>
                    <td className="p-4 text-right text-lg font-black text-red-600 whitespace-nowrap">{Math.floor(planData.p2.total).toLocaleString()}원</td>
                  </tr>
                </tfoot>
              </table>
              
              <div className="mt-10 p-8 bg-red-50 rounded-2xl border border-red-100">
                <div className="font-bold mb-4 flex items-center gap-2 text-red-800"><ThumbsUp size={18}/> 2안 보장 혜택 요약</div>
                <div className="space-y-2 text-sm text-red-700">
                  <div className="flex justify-between border-b border-red-200 border-dashed pb-1"><span>(무)장기요양 복합재가급여특약</span> <span className="font-bold">{planData.p2.complex}만원</span></div>
                  <div className="flex justify-between border-b border-red-200 border-dashed pb-1"><span>(무)복지용구지원특약</span> <span className="font-bold">{planData.p2.welfare}만원</span></div>
                  <div className="flex justify-between border-b border-red-200 border-dashed pb-1"><span>(무)경증이상재가급여지원특약</span> <span className="font-bold">{planData.p2.mild}만원</span></div>
                  {planData.p2.visit > 0 && (
                    <div className="flex justify-between border-b border-red-200 border-dashed pb-1"><span>(무)장기요양 방문요양보장특약</span> <span className="font-bold">{planData.p2.visit}만원</span></div>
                  )}
                  {planData.p2.diagnosis > 0 && (
                    <div className="flex justify-between border-b border-red-200 border-dashed pb-1"><span>(무)경증이상 진단금</span> <span className="font-bold">{planData.p2.diagnosis}만원</span></div>
                  )}
                </div>
              </div>

              <div className="mt-6 bg-slate-900 p-6 rounded-2xl text-center text-white">
                <div className="flex justify-center items-center gap-2 mb-3 font-bold text-yellow-400 text-lg">
                  <CheckCircle2 size={22}/> 전문가의 강력 추천
                </div>
                <p className="text-lg text-slate-300 leading-relaxed font-medium">
                  물가 상승과 길어지는 노년의 생활비를 고려할 때,<br/>
                  든든한 보장이 필수적입니다.<br/>
                  보험료는 합리적이면서 혜택은 극대화한 <br/>
                  <span className="text-white font-bold underline decoration-yellow-400">최대 보장 플랜(2안)</span>을 적극 추천드립니다.
                </p>
              </div>
            </div>
          )}

          {/* PAGE 5: 수령액 예시 (복지용구 포함) */}
          <div id="proposal-page-5" className="bg-white w-full aspect-[1/1.414] p-[20mm] shadow-2xl mb-8 print:shadow-none print:m-0 break-after-page">
            <h2 className="text-3xl font-black text-slate-900 mb-10 pb-4 border-b-2 border-slate-200">
              장기요양등급 판정 시<br/>
              <span className="text-red-600">매월 수령하는 보험금</span> 예시
            </h2>

            {/* 매월 지급 (복지용구 포함) */}
            <div className="bg-blue-50 rounded-3xl p-8 mb-8 relative overflow-hidden">
              <div className="absolute top-0 right-0 p-6 opacity-10"><Coins size={100}/></div>
              <h3 className="text-xl font-bold text-blue-900 mb-6 flex items-center gap-2">
                <Calendar className="text-blue-600"/> 매월 연금처럼 따박따박!
              </h3>
              
              <div className="space-y-4">
                <div className="flex justify-between items-center border-b border-blue-200 pb-2">
                  <span className="text-slate-600">1. 복합재가급여 (주야간보호 포함 2가지 이용 시)</span>
                  <span className="text-xl font-bold text-slate-800">{planData.group === 3 ? planData.p1.complex : (planData.group !== 3 ? planData.p2.complex : planData.p1.complex)}만원</span>
                </div>
                <div className="flex justify-between items-center border-b border-blue-200 pb-2">
                  <span className="text-slate-600">2. 경증이상재가급여 (재가급여 1가지 이상 이용 시)</span>
                  <span className="text-xl font-bold text-slate-800">{planData.group === 3 ? planData.p1.mild : (planData.group !== 3 ? planData.p2.mild : planData.p1.mild)}만원</span>
                </div>
                <div className="flex justify-between items-center border-b border-blue-200 pb-2">
                  <span className="text-slate-600">3. 복지용구 (매월)</span>
                  <span className="text-xl font-bold text-slate-800">{planData.group === 3 ? planData.p1.welfare : (planData.group !== 3 ? planData.p2.welfare : planData.p1.welfare)}만원</span>
                </div>
                {(planData.group === 3 ? planData.p1.visit : planData.p2?.visit) > 0 && (
                  <div className="flex justify-between items-center border-b border-blue-200 pb-2">
                    <span className="text-slate-600">4. 방문요양보장 (방문요양 이용 시 추가)</span>
                    <span className="text-xl font-bold text-slate-800">{planData.group === 3 ? planData.p1.visit : planData.p2.visit}만원</span>
                  </div>
                )}
              </div>

              <div className="mt-6 pt-6 border-t-2 border-blue-200 flex justify-between items-end">
                <span className="text-lg font-bold text-blue-900">매월 최대 수령액 합계</span>
                <span className="text-4xl font-black text-red-600">
                  {(
                    (planData.group === 3 ? planData.p1.complex : (planData.p2 ? planData.p2.complex : planData.p1.complex)) + 
                    (planData.group === 3 ? planData.p1.mild : (planData.p2 ? planData.p2.mild : planData.p1.mild)) + 
                    (planData.group === 3 ? planData.p1.welfare : (planData.p2 ? planData.p2.welfare : planData.p1.welfare)) + 
                    ((planData.group === 3 ? planData.p1.visit : (planData.p2 ? planData.p2.visit : 0)) || 0)
                  ).toLocaleString()}만원
                </span>
              </div>
              <p className="text-xs text-blue-500 mt-2 text-right">* 위 조건 모두 충족 시 매월 지급되는 금액입니다.</p>
            </div>

            {/* 일시금 */}
            <div className="bg-green-50 rounded-3xl p-6 border border-green-100 mb-8">
              <h3 className="text-lg font-bold text-green-900 mb-4 flex items-center gap-2">
                <ShieldCheck className="text-green-600"/> 최초 1회 일시지급
              </h3>
              <div className="flex justify-between items-end">
                <span className="text-slate-600 text-sm">경증이상 진단금</span>
                <span className="text-2xl font-bold text-green-700">{planData.group === 3 ? planData.p1.diagnosis : (planData.p2?.diagnosis || 0)}만원</span>
              </div>
              <p className="text-xs text-green-600 mt-2">* 특약 가입 시 지급</p>
            </div>

            {/* 추가 제안 (미래에셋) */}
            <div className="bg-slate-800 rounded-3xl p-8 text-center text-white shadow-xl transform hover:scale-[1.01] transition-transform">
              <p className="text-xl font-medium text-yellow-200 mb-2 flex items-center justify-center gap-2">
                <span className="bg-yellow-500 text-slate-900 text-xs px-2 py-1 rounded-full font-bold">TIP</span>
                월 수령 보험금 한도를 더 늘리고 싶으신가요?
              </p>
              <h4 className="text-3xl font-black text-white mb-2 leading-snug">
                '미래에셋생명 M-케어 치매간병보험'
              </h4>
              <p className="text-xl text-slate-300 font-medium">
                (월 수령 보험료 <span className="text-yellow-400 font-bold underline decoration-2 underline-offset-4">최대 150만원 증액 가능</span>)을<br/>함께 검토해보세요!
              </p>
            </div>
          </div>

          {/* PAGE 6: 특약 상세 설명 (약관 기반) */}
          <div id="proposal-page-6" className="bg-white w-full aspect-[1/1.414] p-[20mm] shadow-2xl mb-8 print:shadow-none print:m-0 break-after-page">
            <h2 className="text-3xl font-black text-slate-900 mb-10 pb-4 border-b-2 border-slate-200">주요 특약 상세 안내</h2>
            
            <div className="space-y-8">
              <div className="flex gap-5">
                <div className="w-12 h-12 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0 text-slate-700 font-black text-xl">01</div>
                <div>
                  <h3 className="text-xl font-bold text-slate-800 mb-2">(무)장기요양(1~5등급) 복합재가급여특약</h3>
                  <div className="p-4 bg-slate-50 rounded-lg border-l-4 border-red-500 mb-2">
                    <p className="text-slate-800 font-bold text-sm">
                      “복합재가급여”란 ‘방문요양, 방문목욕, 방문간호, 주·야간보호, 단기보호’ 중 두 가지 종류 이상의 급여를 이용하는 경우를 말합니다.
                    </p>
                  </div>
                  <p className="text-slate-600 text-sm leading-relaxed mb-2 text-justify">
                    보장개시일 이후 장기요양 1~5등급 판정을 받고, 매월 위 정의에 해당하는 복합적인 재가급여를 이용할 때 가입금액을 지급합니다.
                  </p>
                </div>
              </div>

              <div className="flex gap-5">
                <div className="w-12 h-12 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0 text-slate-700 font-black text-xl">02</div>
                <div>
                  <h3 className="text-xl font-bold text-slate-800 mb-2">(무)경증이상재가급여지원특약</h3>
                  <p className="text-slate-600 text-sm leading-relaxed mb-2 text-justify">
                    장기요양 1~5등급 판정을 받고, 재가급여(방문요양, 방문목욕, 방문간호, 주야간보호, 단기보호 등)를 월 1회 이상 이용하면 지급되는 가장 기본적인 보장입니다. 복합재가급여와 달리 서비스 종류의 조합 조건이 없어 <strong>하나만 이용해도 지급</strong>됩니다.
                  </p>
                </div>
              </div>

              <div className="flex gap-5">
                <div className="w-12 h-12 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0 text-slate-700 font-black text-xl">03</div>
                <div>
                  <h3 className="text-xl font-bold text-slate-800 mb-2">(무)장기요양(1~5등급) 방문요양보장특약</h3>
                  <p className="text-slate-600 text-sm leading-relaxed mb-2 text-justify">
                    요양보호사가 가정을 방문하여 신체활동 및 가사활동을 지원하는 <strong>'방문요양'</strong> 서비스를 이용했을 때 추가로 지급되는 담보입니다. 거동이 불편하여 센터 이동이 힘든 경우 가장 많이 이용하는 서비스입니다.
                  </p>
                </div>
              </div>

              <div className="flex gap-5">
                <div className="w-12 h-12 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0 text-slate-700 font-black text-xl">04</div>
                <div>
                  <h3 className="text-xl font-bold text-slate-800 mb-2">(무)장기요양(1~5등급) 복지용구보장특약</h3>
                  <p className="text-slate-600 text-sm leading-relaxed mb-2 text-justify">
                    휠체어, 전동침대, 지팡이, 미끄럼 방지 매트 등 노인장기요양보험법에서 정한 <strong>복지용구를 구입하거나 대여</strong>했을 때, 가입금액을 매월 지급합니다. (단, 본인부담금이 발생해야 함)
                  </p>
                </div>
              </div>

              <div className="flex gap-5">
                <div className="w-12 h-12 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0 text-slate-700 font-black text-xl">05</div>
                <div>
                  <h3 className="text-xl font-bold text-slate-800 mb-2">(무)표적치매약물허가치료특약</h3>
                  <p className="text-slate-600 text-sm leading-relaxed mb-2 text-justify">
                    치매 보장개시일 이후 치매로 진단확정되고, 치료를 목적으로 <strong>'표적치매약물허가치료'</strong>를 받았을 때 최초 1회에 한해 지급합니다. (식품의약품안전처에서 허가된 효능/효과 범위 내 사용에 한함)
                  </p>
                </div>
              </div>
            </div>

            <div className="mt-auto pt-8 border-t border-slate-100">
              <p className="text-xs text-slate-400 leading-tight">
                ※ 위 내용은 약관의 요약본으로, 보험금 지급사유, 지급제한 사유 등 세부적인 내용은 반드시 약관 및 상품설명서를 참조하시기 바랍니다.<br/>
                ※ 상기 예시된 가입금액 및 보험료는 기준 연령에 따라 달라질 수 있습니다.
              </p>
            </div>
          </div>

          {/* PAGE 7: 감사 인사 */}
          <div id="proposal-page-7" className="bg-white w-full aspect-[1/1.414] p-[20mm] flex flex-col justify-between items-center text-center shadow-2xl mb-8 print:shadow-none print:m-0 relative overflow-hidden">
            <div className="mt-40 z-10 flex flex-col items-center">
              <div className="w-24 h-24 bg-red-600 text-white rounded-full flex items-center justify-center mb-8 shadow-xl">
                <Heart size={48} fill="currentColor" />
              </div>
              <h2 className="text-5xl font-black text-slate-900 mb-8">감사합니다</h2>
              <p className="text-2xl text-slate-500 font-light leading-relaxed mb-12">
                고객님의 품격 있는 노후,<br/>
                <strong className="text-slate-900 font-bold">메타리치</strong>가 가장 가까운 곳에서<br/>
                끝까지 지켜드리겠습니다.
              </p>
              
              <div className="bg-slate-50 border border-slate-200 rounded-2xl p-8 max-w-md w-full">
                <div className="flex items-center justify-center gap-4 mb-4 text-slate-800">
                  <PhoneCall size={32} className="text-red-600" />
                  <h3 className="text-xl font-bold">상세 안내 예정</h3>
                </div>
                <p className="text-slate-600 leading-relaxed">
                  본 제안서에 대한 더 자세한 설명과<br/>
                  가입 절차 안내를 위해 담당자가<br/>
                  곧 전화로 연락드리겠습니다.
                </p>
              </div>
            </div>

            <div className="w-full z-10">
              <div className="h-px bg-slate-200 w-full mb-12"></div>
              <div className="flex flex-col items-center gap-6">
                <div className="text-slate-400 text-sm tracking-[0.3em] uppercase font-bold">Trusted Insurance Partner</div>
                <MetarichLogo className="h-10" />
                <p className="text-slate-400 mt-4 text-sm">{agent.branch} | {agent.name} | {agent.contact}</p>
              </div>
            </div>
            
            {/* 배경 데코레이션 */}
            <div className="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-slate-50 to-transparent -z-0"></div>
          </div>

        </div>
      )}

      <style>
        {`
          @media print {
            body { background: white !important; padding: 0 !important; margin: 0 !important; }
            .no-print { display: none; }
            .break-after-page { page-break-after: always; }
            @page { size: A4; margin: 0; }
          }
        `}
      </style>
    </div>
  );
};

export default App;
